<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Smart Letter Drafter - AGMHSS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tinos:wght@400;700&display=swap');
        .paper-font { font-family: 'Tinos', serif; }
        
        /* Forces the preview to act as a physical A4 paper */
        #letter-preview { 
            width: 210mm; 
            height: 297mm; 
            position: relative; 
            background: white;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            overflow: hidden; /* Ensures text doesn't spill out of paper */
        }
        
        /* Template fills the paper exactly */
        #bgTemplate {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: fill;
            z-index: 0;
        }

        /* Content sits on top of the image */
        #contentArea { 
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: padding 0.1s ease;
        }

        @media print { .no-print { display: none; } }
    </style>
</head>
<body class="bg-slate-300 min-h-screen pb-10">

<div class="no-print bg-slate-900 text-white p-4 mb-6 shadow-md flex justify-between items-center px-10">
    <h1 class="text-xl font-bold tracking-tight">AI Letter Pad SPA</h1>
    <div class="text-xs uppercase tracking-widest text-slate-400 font-semibold">AGMHSS IT Department</div>
</div>

<div class="max-w-[1400px] mx-auto px-4 grid grid-cols-1 lg:grid-cols-12 gap-8">
    
    <div class="lg:col-span-4 space-y-4 no-print">
        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
            <h2 class="font-bold text-gray-800 mb-4 border-b pb-2">Layout & Tools</h2>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">1. Letterhead Template</label>
                    <input type="file" id="templateInput" accept="image/*" class="w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-slate-100 file:text-slate-700 hover:file:bg-slate-200">
                </div>

                <div class="p-4 bg-indigo-50 rounded-xl border border-indigo-100">
                    <label class="block text-xs font-bold text-indigo-900 uppercase mb-1">2. Reply Mode (Scan Letter)</label>
                    <input type="file" id="receivedLetterInput" accept="image/*" class="w-full text-xs mb-2">
                    <button onclick="processOCR()" id="ocrBtn" class="w-full bg-indigo-600 text-white py-2 rounded-lg text-sm font-semibold hover:bg-indigo-700">Scan Reference Letter</button>
                </div>

                <div class="space-y-4 bg-slate-50 p-4 rounded-xl border border-slate-200">
                    <p class="text-[10px] font-black text-slate-400 uppercase">Text Alignment (mm)</p>
                    
                    <div>
                        <div class="flex justify-between text-xs mb-1 font-medium text-slate-600"><span>Top Space</span><span id="topVal">45mm</span></div>
                        <input type="range" id="topMargin" min="10" max="180" value="45" class="w-full h-1.5 bg-slate-300 rounded-lg appearance-none cursor-pointer accent-slate-800">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="flex justify-between text-[10px] mb-1 font-bold"><span>Left</span><span id="leftVal">25mm</span></div>
                            <input type="range" id="leftMargin" min="10" max="100" value="25" class="w-full h-1 bg-slate-300 rounded-lg appearance-none cursor-pointer accent-slate-800">
                        </div>
                        <div>
                            <div class="flex justify-between text-[10px] mb-1 font-bold"><span>Right</span><span id="rightVal">20mm</span></div>
                            <input type="range" id="rightMargin" min="10" max="100" value="20" class="w-full h-1 bg-slate-300 rounded-lg appearance-none cursor-pointer accent-slate-800">
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">3. AI Drafting Context</label>
                    <textarea id="userPrompt" rows="3" class="w-full border border-slate-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-slate-900 outline-none" placeholder="Explain the purpose of the letter..."></textarea>
                </div>

                <button onclick="generateAIDraft()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold hover:bg-black transition-all shadow-lg">Generate AI Draft</button>
            </div>
        </div>
    </div>

    <div class="lg:col-span-8 flex flex-col items-center">
        <div class="sticky top-6">
            <div id="letter-preview" class="paper-font text-slate-900 shadow-2xl">
                <img id="bgTemplate" class="hidden" alt="Template Preview">
                
                <div id="contentArea" style="padding: 45mm 20mm 20mm 25mm;">
                    <div class="text-right">
                        <span contenteditable="true" id="currentDate" class="outline-none border-b border-transparent hover:border-slate-300"></span>
                    </div>
                    
                    <div id="salutation" contenteditable="true" class="font-bold outline-none hover:bg-slate-50 text-lg">Respected Sir/Madam,</div>
                    
                    <div id="bodyText" contenteditable="true" class="leading-relaxed text-justify outline-none min-h-[300px] hover:bg-slate-50 text-[12pt]">
                        Select your school letterhead template on the left. The text you type here will appear "inside" your template, aligned perfectly with the margins you set.
                    </div>
                    
                    <div id="closing" class="mt-auto pb-10">
                        <div id="thanksField" contenteditable="true" class="outline-none hover:bg-slate-50">Thanking you,</div>
                        <div class="pt-8">
                            <div id="SignedBy" contenteditable="true" class="outline-none hover:bg-slate-50">Yours Faithfully,</div>
                        <div class="pt-11">
                            <p id="signatory" contenteditable="true" class="font-bold mt-4 outline-none hover:bg-slate-50 italic text-lg">[Name/Designation]</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <button onclick="downloadPDF()" class="no-print mt-6 w-full bg-rose-600 text-white py-4 rounded-xl font-bold shadow-xl hover:bg-rose-700 flex items-center justify-center gap-3 active:scale-95 transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Download Final PDF
            </button>
        </div>
    </div>
</div>

<script>
    // Current Date Logic
    document.getElementById('currentDate').innerText = new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });

    // Slider Logic for Inner Alignment
    const content = document.getElementById('contentArea');
    const sliders = {
        top: { el: document.getElementById('topMargin'), val: document.getElementById('topVal'), prop: 'paddingTop' },
        left: { el: document.getElementById('leftMargin'), val: document.getElementById('leftVal'), prop: 'paddingLeft' },
        right: { el: document.getElementById('rightMargin'), val: document.getElementById('rightVal'), prop: 'paddingRight' }
    };

    Object.keys(sliders).forEach(key => {
        sliders[key].el.oninput = function() {
            const val = this.value + "mm";
            content.style[sliders[key].prop] = val;
            sliders[key].val.innerText = val;
        };
    });

    // Template Upload
    document.getElementById('templateInput').onchange = function(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = document.getElementById('bgTemplate');
            img.src = event.target.result;
            img.classList.remove('hidden');
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    // OCR Logic
    async function processOCR() {
        const file = document.getElementById('receivedLetterInput').files[0];
        if (!file) return alert("Upload a document image first.");
        const btn = document.getElementById('ocrBtn');
        btn.innerText = "⏳ Scanning...";
        try {
            const { data: { text } } = await Tesseract.recognize(file, 'eng');
            document.getElementById('userPrompt').value = "REPLY TO THIS: " + text;
            btn.innerText = "✅ Scan Complete";
        } catch (e) { btn.innerText = "OCR Error"; }
    }

    // Mock AI Drafting
    async function generateAIDraft() {
        const prompt = document.getElementById('userPrompt').value;
        const body = document.getElementById('bodyText');
        body.innerHTML = "<i>Drafting professional letter content...</i>";
        setTimeout(() => {
            body.innerText = "This is a formal communication regarding the Smart School Initiative. We have reviewed the recent developments and are proceeding with the next phase of modernization for our school infrastructure. Please find the attached report for your consideration.";
            document.getElementById('signatory').innerText = "Rajarajan\nIT Dept, AGMHSS";
        }, 1200);
    }

    // PDF Export
    function downloadPDF() {
        const element = document.getElementById('letter-preview');
        const opt = {
            margin: 0,
            filename: 'Official_Letterhead_Document.pdf',
            image: { type: 'jpeg', quality: 1 },
            html2canvas: { scale: 3, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }
</script>
</body>
</html>
